# Создание контейнера

После регистрации всех компонентов в `DIContainerBuilder`, или просто билдере, библиотека должна проверить, что не нарушены правила регистрации компонентов. После чего она оптимизирует данные для дальнейшего использования, и выдает на выходе контейнер, с которым будет дальнейшая работа.

Основная цель создания контейнера - отсечь все возможные ошибки как можно раньше. 

## Синтаксис
Чтобы создать контейнер, достаточно у билдера, вызвать метод `build`:
```Swift
let container = try! builder.build()
```

## Процесс создания

Так как во время создания проверяется не нарушены ли правила регистрации и нет ли конфликтов в зависимостях. Поэтому метод `build` может кинуть исключение. Для удобства пользования все возникшие ошибки объединяются в одно исключение содержащее все обнаруженные ошибки.
Настоятельно рекомендую не игнорировать эти исключения, и ранять программу в случае возникновения ошибок, но библиотека не заставляет это делать обязательно, возможно в случае ошибки приложение будет выполнять какие-нибудь специфические действия.


## Проверки и исключения
Все возникшие ошибки объединяются в: `DIError.build(errors: [DIError])`. Далее по тексту будет идти речь об ошибках, которые попадают в список errors.

! Во время чтения этой главы, будет описан синтаксис не встречающийся на текущий момент в документации, поэтому рекомендую вернуться еще раз к этой главе позже.

Во время создания контейнера, библиотека проверяет:
* Нет совпадений имен для одного и того же типа.
> Ошибка: **`DIError.multyRegisterNamesForType(names:, forType:)`**
> Пример:
> ```Swift
> builder.register(Cat.self).asName("Felix")...
> builder.register(Cat.self).asName("Felix")...
> ```
> В данном примере, регистрируются две кошки, с одним и темже именем.
***

* При множественной регистрации указано не более одного default:
> Ошибка: **`DIError.multyRegisterDefault(typeNames:, forType:)`**
> Пример:
> ```Swift
> builder.register(Cat.self).asDefault()...
> builder.register(Cat.self).asDefault()...
> ```
> В данном примере, регистрируются две кошки, и обе объявлены по умолчанию.
***

* При множественной регистрации указан или один default, или все компоненты имеют разные имена.
> Ошибка: **`DIError.notSetDefaultForMultyRegisterType(typeNames:,forType:)`**
> Пример:
> ```Swift
> builder.register(Cat.self)...
> builder.register(Cat.self)...
> try! builder.build()
> ```
> В данном примере, регистрируется две кошки при этом: не указываем какая из них default и не указываем им разные имена. В дальнейшем, при создании объекта, библиотеке не отчего будет отталкивать, чтобы выбрать каким воспользоваться компонентом.
***

* У типа есть хотябы один метод инициализации, или данный тип отмечат как `perRequest`
> Ошибка: **`DIError.notSetInitializer(typeName:)`**
> Пример:
> ```Swift
> builder.register(Cat.self)
> try! builder.build()
> ```
> В данном примере, мы зарегестрировали кошку, но не указали каким метод её создавать. Такой компонент не имеет смысла так как в дальнейшем не получиться создать объявленный тип.
***


##### Примечание
```Swift
builder.register(Cat.self).asType(Birds.self)...
``` 
Данный пример содержит ошибку: кот не является птицей, но не смотря на это библиотека пропустит такой код на стадии компиляции и на стадии сборки контейнера.
Ошибка обнаружиться только в тот момент когда программа запросит у библиотеки тип `Birds` - будет произведена проверка, что кошка не является котом, и кинется исключение: **`DIError.typeIncorrect(askableType:, realType:)`**

На текущий момент swift не имеет возможностей проверить связь между двумя типами.